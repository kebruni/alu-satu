# โ๏ธ ะะพะฝัะธะณััะฐัะธั ะดะปั ะดะพะผะตะฝะฐ alusatu.kebruni.me

## ะงัะพ ะฟะธัะฐัั ะฒ `.env` ัะฐะนะป

### ะะฐัะฐ ะบะพะฝัะธะณััะฐัะธั:

```env
# ========== BACKEND (Node.js) ==========

# ะะตะถะธะผ - ะพััะฐะฒะธัั ะบะฐะบ ะตััั
NODE_ENV=production

# ะะพัั ะฑัะบะตะฝะดะฐ - ะพััะฐะฒะธัั ะบะฐะบ ะตััั
PORT=4000

# ะะ โ ะดะฒะต ะพะฟัะธะธ:
#   * ะบะพะฝัะตะนะฝะตั ะฒ ััะตะบะต (ะฟะพ ัะผะพะปัะฐะฝะธั, ะปะพะบะฐะปัะฝะฐั Mongo ะฝะฐ 192.168.1.52)
#   * MongoDB Atlas (ัะดะฐะปัะฝะฝะฐั ะฑะฐะทะฐ, ััะตะฑัะตั IPโะฒะฐะนัะปะธัั)
#   ะะตะฝัะนัะต ัะพะปัะบะพ ะพะดะฝั ัััะพะบะธ โ ะปะธะฑะพ ะฟะตัะฒัั, ะปะธะฑะพ ะฒัะพััั.
#
# ะปะพะบะฐะปัะฝัะน ะบะพะฝัะตะนะฝะตั (ััะพ ัะพะฒะฟะฐะดะฐะตั ั ัะตัะฒะธัะพะผ "mongodb" ะฒ docker-compose):
# MONGO_URI=mongodb://admin:password123@mongodb:27017/alu-satu?authSource=admin
#
# [ะฐะปััะตัะฝะฐัะธะฒะฐ] Atlas URI, ะบะพัะพััะน ะฒั ะฟะพะปััะธัะต ะธะท ะฟะฐะฝะตะปะธ MongoDB Atlas:
# MONGO_URI=mongodb+srv://USER:PASSWORD@clusterX.kuhpksq.mongodb.net/alu-satu?retryWrites=true&w=majority
#   (ะพััะฐะฒััะต ัะฒะพั ัััะพะบั ะฝะฐ ะผะตััะต USER:PASSWORD ะธ ะฐะดัะตั ะบะปะฐััะตัะฐ)

MONGO_URI=mongodb://admin:password123@mongodb:27017/alu-satu?authSource=admin

# ๐ ะกะตะบัะตัะฝัะน ะบะปัั ะดะปั ัะพะบะตะฝะพะฒ - ะะะะะะะขะ ะฝะฐ ัะปะพะถะฝัะน!
JWT_SECRET=mK9x#pL@2kq$X9vM%nP5Rw8YxZa1Bc3De5Fg7Hi9Jk

# โ ะะฐั ะดะพะผะตะฝ - ะพัะบัะดะฐ ัะฐะทัะตัะตะฝั ะทะฐะฟัะพัั
CORS_ORIGIN=https://alusatu.kebruni.me

# ========== FRONTEND (React Vite) ==========

# API endpoint ะดะปั ััะพะฝัะตะฝะดะฐ
VITE_API_URL=https://alusatu.kebruni.me/api
```

---

## ะะพัะฐะณะพะฒะพ - ััะพ ะบัะดะฐ ะฟะธัะตััั

### 1๏ธโฃ NODE_ENV
```
ะงัะพ: ะะบััะถะตะฝะธะต ัะฐะทัะฐะฑะพัะบะธ
ะะปั ะฒะฐั: production
ะะตะฝััั: ะะะข
```

### 2๏ธโฃ PORT
```
ะงัะพ: ะะฐ ะบะฐะบะพะผ ะฟะพััั ะทะฐะฟััะบะฐะตััั ะฑัะบะตะฝะด ะฒะฝัััะธ ะบะพะฝัะตะนะฝะตัะฐ
ะะปั ะฒะฐั: 4000
ะะตะฝััั: ะะะข
```

### 3๏ธโฃ MONGO_URI
```
ะงัะพ: ะะดัะตั ะฟะพะดะบะปััะตะฝะธั ะบ ะะ. ะะฐัะธะฐะฝัั:
  โข ะปะพะบะฐะปัะฝะฐั Mongo (โmongodbโ ัะตัะฒะธั) โ ะธัะฟะพะปัะทัะตััั ะฒะฝัััะธ docker_app_net
  โข MongoDB Atlas โ ัะดะฐะปัะฝะฝัะน ะบะปะฐััะตั, ััะตะฑัะตั IPโะฒะฐะนัะปะธัั.

ะัะธะผะตัั:
  # ะปะพะบะฐะปัะฝัะน ะบะพะฝัะตะนะฝะตั (ะฟะพ ัะผะพะปัะฐะฝะธั)
  mongodb://admin:password123@mongodb:27017/alu-satu?authSource=admin

  # Atlas (ะทะฐะผะตะฝะธัะต USER/PASSWORD ะธ ะฐะดัะตั ะบะปะฐััะตัะฐ ัะฒะพะธะผ):
  mongodb+srv://akaiaksai:Tsukuyomidream1.@cluster1.kuhpksq.mongodb.net/alu-satu?
    retryWrites=true&w=majority&appName=Cluster1

ะะปั ะฒะฐั: ะธัะฟะพะปัะทัะนัะต ะปะธะฑะพ ะฟะตัะฒัะน, ะปะธะฑะพ ะฒัะพัะพะน. ะะตะฝััั: ะะ โ ะตัะปะธ ะฒั
ะฟะพะดะบะปััะฐะตัะตัั ะบ ัะดะฐะปัะฝะฝะพะน ะฑะฐะทะต, ะฟะพะดััะฐะฒััะต Atlas URI. ะัะปะธ ะพััะฐััะตัั ะปะพะบะฐะปัะฝะพ,
ะฝะต ััะพะณะฐะนัะต.
```

### 4๏ธโฃ JWT_SECRET โ๏ธ ะะะะะ!
```
ะงัะพ: ะกะตะบัะตัะฝัะน ะบะปัั ะดะปั ัะธััะพะฒะฐะฝะธั ัะพะบะตะฝะพะฒ ะฐะฒัะพัะธะทะฐัะธะธ
ะะปั ะฒะฐั: ะัะฑะพะน ัะปะพะถะฝัะน ะฟะฐัะพะปั ะธะท ะฑัะบะฒ, ัะธัั, ัะฟะตััะธะผะฒะพะปะพะฒ
ะัะธะผะตั: mK9x#pL@2kq$X9vM%nP5Rw8YxZa1Bc3De5Fg7Hi9Jk
ะะตะฝััั: ะะ! ะกะณะตะฝะตัะธััะนัะต ัะฒะพะน
```

**ะะฐะบ ัะณะตะฝะตัะธัะพะฒะฐัั ะฑะตะทะพะฟะฐัะฝัะน ะบะปัั:**
```bash
# Linux/Mac
openssl rand -base64 32

# Windows PowerShell
[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes((Get-Random -Count 32 | % {[char]$_}) -join ""))
```

### 5๏ธโฃ CORS_ORIGIN โ ะะะฏ ะะะจะะะ ะะะะะะ
```
ะงัะพ: ะก ะบะฐะบะธั ะดะพะผะตะฝะพะฒ ััะพะฝัะตะฝะด ะผะพะถะตั ะพะฑัะฐัะฐัััั ะบ ะฑัะบะตะฝะดั
ะะปั ะฒะฐั: https://alusatu.kebruni.me
ะะตะฝััั: ะะ! ะััะฐะฒััะต ะฒะฐั ะดะพะผะตะฝ
```

### 6๏ธโฃ VITE_API_URL โ ะะะฏ ะะะจะะะ ะะะะะะ
```
ะงัะพ: ะะดัะตั API ะดะปั ััะพะฝัะตะฝะด ะฟัะธะปะพะถะตะฝะธั
ะะปั ะฒะฐั: https://alusatu.kebruni.me/api
ะะตะฝััั: ะะ! ะััะฐะฒััะต ะฒะฐั ะดะพะผะตะฝ + /api
```

---

## ๐ ะะพัะพะฒะฐั ะธะฝััััะบัะธั

### ะะฐ ะฒะฐัะตะผ Debian ัะตัะฒะตัะต:

```bash
# 1. ะะตัะตะนะดะธัะต ะฒ ะฟะฐะฟะบั ะฟัะพะตะบัะฐ
cd /opt/alu-sะฐัั

# 2. ะกะพะทะดะฐะนัะต ัะฐะนะป .env
nano .env

# 3. ะััะฐะฒััะต ััะพ:
NODE_ENV=production
PORT=4000
MONGO_URI=mongodb://admin:password123@mongodb:27017/alu-satu?authSource=admin
JWT_SECRET=mK9x#pL@2kq$X9vM%nP5Rw8YxZa1Bc3De5Fg7Hi9Jk
CORS_ORIGIN=https://alusatu.kebruni.me
VITE_API_URL=https://alusatu.kebruni.me/api

# 4. ะะฐะถะผะธัะต Ctrl+X, ะฟะพัะพะผ Y, ะฟะพัะพะผ Enter (ะตัะปะธ ะธัะฟะพะปัะทัะตัะต nano)

# 5. ะัะพะฒะตัััะต ััะพ ัะพะทะดะฐะปัั
cat .env

# 6. ะะฐะฟัััะธัะต ะฟัะพะตะบั
docker-compose up -d
```

---

## ๐ ะะฐะบ ะฑัะดะตั ัะฐะฑะพัะฐัั?

<!-- insert alert about testing Mongo -->

### ะัะพะฒะตัะบะฐ MongoDB Atlas URI
ะัะปะธ ะฒั ะธัะฟะพะปัะทัะตัะต Atlas, ะฝะตะพะฑัะพะดะธะผะพ ะดะพะฑะฐะฒะธัั IPโะฐะดัะตั ะฒะฐัะตะณะพ ัะตัะฒะตัะฐ ะฒ
Network Access (whitelist) ะฟะฐะฝะตะปะธ Atlas. **ะะฐะถะฝะพ:** ะทะฐะฟัะพัั ะธะดัั ะฝะต ั ัะฐะผะธะผ
ัะพััะพะผ, ะฐ ะธะท ะบะพะฝัะตะนะฝะตัะฐ; ะตะณะพ ะธััะพะดััะธะน IP ะพะฑััะฝะพ ะพัะปะธัะฐะตััั. ะตัะปะธ ะฒ ะปะพะณะต
`/api/health` ะฒั ัะฒะธะดะธัะต `mongo":"disconnected"`, ะทะฝะฐัะธั Atlas ะพัะฒะตัะณะฐะตั
**IP ะบะพะฝัะตะนะฝะตัะฐ**. ะฟัะพัะต ะฒัะตะณะพ ะฒ whitelist ะดะพะฑะฐะฒะธัั ะฟัะฐะฒะธะปะพ `0.0.0.0/0` ะฒะพ ะฒัะตะผั
ะฝะฐัััะพะนะบะธ ะธะปะธ ะฟะตัะตะบะปััะธัััั ะฝะฐ ะปะพะบะฐะปัะฝัั Mongo.

ะงัะพะฑั ัะฑะตะดะธัััั, ััะพ ัััะพะบะฐ ัะฐะฑะพัะฐะตั, ะผะพะถะฝะพ ะฒัะฟะพะปะฝะธัั ะฝะฐ ัะพััะต:

```bash
# ะบัะฐัะบะฐั ะฟัะพะฒะตัะบะฐ ะฑะตะท ัััะฐะฝะพะฒะบะธ shell
docker run --rm -it mongo:7 mongosh \
  "${MONGO_URI}"
```

(ััะพั ัะตัั ะฒัะฟะพะปะฝัะตััั ั ัะพััะฐ, ะฟะพััะพะผั ะพะฝ ะฝะต ะณะฐัะฐะฝัะธััะตั, ััะพ ะบะพะฝัะตะนะฝะตั
ะฟะพะดะบะปััะธััั).
ััะฟะตั ะฑัะดะตั ะฒัะณะปัะดะตัั ัะฐะบ:
```
Connecting to: mongodb+srv://cluster1.kuhpksq.mongodb.net/alu-satu?...
MongoDB server version: 7.0.x
test>
```
ะฟัะธ ะพัะธะฑะบะต ะฒั ะฟะพะปััะธัะต ะธะฝัะพัะผะฐัะธั ะพะฑ IP-ะฒะฐะนัะปะธััะต ะธะปะธ ะฐััะตะฝัะธัะธะบะฐัะธะธ.

ะัะปะธ ะฟัะพะฒะตัะบะฐ ะฟัะพัะปะฐ, ะฟะตัะตะทะฐะฟัััะธัะต ะฑัะบะตะฝะด:

```bash
cd /opt/alu-satu
docker compose down
docker compose up -d --build backend
```

ะธ ัะฑะตะดะธัะตัั, ััะพ `/api/health` ะฒะพะทะฒัะฐัะฐะตั `{"status":"ok","mongo":"connected"}`.


```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ะัะฐัะทะตั ะฟะพะปัะทะพะฒะฐัะตะปั                   โ
โ  https://alusatu.kebruni.me             โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ
             โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  NGINX (Reverse Proxy)                  โ
โ  ะฟะพัั 80 ะธ 443 (HTTPS)                  โ
โ  ะฝะฐ ัะตัะฒะตัะต Debian 12                   โ
โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
             โ
    โโโโโโโโโโดโโโโโโโโโ
    โผ                 โผ
โโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโ
โ Frontend    โ   โ Backend API โ
โ :3000       โ   โ :4000       โ
โ React+Vite  โ   โ Node.js     โ
โโโโโโโโโโโโโโโ   โโโโโโโโฌโโโโโโโ
                         โ
                         โผ
                  โโโโโโโโโโโโโโโ
                  โ MongoDB     โ
                  โ :27017      โ
                  โโโโโโโโโโโโโโโ
```

---

## โก ะขะฐะฑะปะธัะฐ ะฒัะตั ะฟะตัะตะผะตะฝะฝัั

| ะะตัะตะผะตะฝะฝะฐั | ะงัะพ ััะพ | ะะฝะฐัะตะฝะธะต ะดะปั ะฒะฐั | ะะตะฝััั? |
|-----------|--------|-----------------|---------|
| `NODE_ENV` | ะะตะถะธะผ | `production` | โ ะะะข |
| `PORT` | ะะพัั ะฑัะบะตะฝะดะฐ | `4000` | โ ะะะข |
| `MONGO_URI` | ะะ ะฟะพะดะบะปััะตะฝะธะต | `mongodb://admin:password123@mongodb:27017/alu-satu?authSource=admin` | โ ะะะข |
| `JWT_SECRET` | ๐ ะกะตะบัะตัะฝัะน ะบะปัั | ะะะจ ะกะะะะะซะ ะะะะะะฌ | โ ะะ! |
| `CORS_ORIGIN` | โ ะะพะผะตะฝ ััะพะฝัะฐ | `https://alusatu.kebruni.me` | โ ะะ! |
| `VITE_API_URL` | โ ะะดัะตั API | `https://alusatu.kebruni.me/api` | โ ะะ! |

---

## ะัะพะฒะตัะบะฐ ะฝะฐ ะพัะธะฑะบะธ

```bash
# ะัะพะฒะตัะธัั ััะพ .env ัะพะทะดะฐะฝ
cat /opt/alu-satu/.env

# ะัะพะฒะตัะธัั ะปะพะณะธ ััะพะฝัะตะฝะดะฐ
docker logs alu-satu-frontend

# ะัะพะฒะตัะธัั ะปะพะณะธ ะฑัะบะตะฝะดะฐ
docker logs alu-satu-backend

# ะัะพะฒะตัะธัั ััะพ ะบะพะฝัะตะนะฝะตัั ะทะฐะฟััะตะฝั
docker ps
```

## ะะพะฝัะฐะบั ะดะปั ะฟะพะผะพัะธ
ะัะปะธ ััะพ-ัะพ ะฝะต ัะฐะฑะพัะฐะตั, ะฟัะพะฒะตัััะต:
1. โ ะะพะผะตะฝ corrnet ะฒ `CORS_ORIGIN`
2. โ `/api` ะฒ ะบะพะฝัะต `VITE_API_URL`
3. โ `JWT_SECRET` - ัะปะพะถะฝัะน ะฟะฐัะพะปั
4. โ HTTPS ะฟัะพัะพะบะพะป (ะฝะต http)
